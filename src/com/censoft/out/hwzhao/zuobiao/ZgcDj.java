package com.censoft.out.hwzhao.zuobiao;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.censoft.database.MysqlHelper;
import com.censoft.out.utils.Utils;
import com.censoft.util.FileManager;

public class ZgcDj {
	
	//中关村大街-百度坐标系
	static String zgcdjstr = "[{'lat':'40.094782','lng':'116.282854'},{'lat':'40.094237','lng':'116.281129'},{'lat':'40.09381','lng':'116.279844'},{'lat':'40.09363','lng':'116.27944'},{'lat':'40.09343','lng':'116.279072'},{'lat':'40.093057','lng':'116.278497'},{'lat':'40.092499','lng':'116.277886'},{'lat':'40.091926','lng':'116.27732'},{'lat':'40.091126','lng':'116.276512'},{'lat':'40.090843','lng':'116.276179'},{'lat':'40.090581','lng':'116.275838'},{'lat':'40.089987','lng':'116.274949'},{'lat':'40.088338','lng':'116.272398'},{'lat':'40.087607','lng':'116.271266'},{'lat':'40.086448','lng':'116.269478'},{'lat':'40.085971','lng':'116.268759'},{'lat':'40.085544','lng':'116.268059'},{'lat':'40.085136','lng':'116.267457'},{'lat':'40.084902','lng':'116.26708'},{'lat':'40.084619','lng':'116.266603'},{'lat':'40.08444','lng':'116.266208'},{'lat':'40.084274','lng':'116.265768'},{'lat':'40.083991','lng':'116.264915'},{'lat':'40.08357','lng':'116.26363'},{'lat':'40.083073','lng':'116.262058'},{'lat':'40.082073','lng':'116.258932'},{'lat':'40.081479','lng':'116.25709'},{'lat':'40.080085','lng':'116.252716'},{'lat':'40.079554','lng':'116.250991'},{'lat':'40.079333','lng':'116.25029'},{'lat':'40.076945','lng':'116.251575'},{'lat':'40.070824','lng':'116.255141'},{'lat':'40.069885','lng':'116.255617'},{'lat':'40.069499','lng':'116.255752'},{'lat':'40.068387','lng':'116.256147'},{'lat':'40.067497','lng':'116.256489'},{'lat':'40.066206','lng':'116.25692'},{'lat':'40.065288','lng':'116.257234'},{'lat':'40.064384','lng':'116.257531'},{'lat':'40.063197','lng':'116.258088'},{'lat':'40.062396','lng':'116.258573'},{'lat':'40.061989','lng':'116.25895'},{'lat':'40.06103','lng':'116.25983'},{'lat':'40.059822','lng':'116.260998'},{'lat':'40.058793','lng':'116.262022'},{'lat':'40.058137','lng':'116.262741'},{'lat':'40.057799','lng':'116.263064'},{'lat':'40.057385','lng':'116.263414'},{'lat':'40.057143','lng':'116.263594'},{'lat':'40.056895','lng':'116.263711'},{'lat':'40.056177','lng':'116.264079'},{'lat':'40.055701','lng':'116.264232'},{'lat':'40.054541','lng':'116.264421'},{'lat':'40.053374','lng':'116.2646'},{'lat':'40.0514','lng':'116.264879'},{'lat':'40.050675','lng':'116.264969'},{'lat':'40.050544','lng':'116.265067'},{'lat':'40.050309','lng':'116.265687'},{'lat':'40.049915','lng':'116.266406'},{'lat':'40.04772','lng':'116.269406'},{'lat':'40.046215','lng':'116.2714'},{'lat':'40.045324','lng':'116.272595'},{'lat':'40.044254','lng':'116.273925'},{'lat':'40.044068','lng':'116.274185'},{'lat':'40.043771','lng':'116.274518'},{'lat':'40.042963','lng':'116.275317'},{'lat':'40.041913','lng':'116.276386'},{'lat':'40.040829','lng':'116.277491'},{'lat':'40.04038','lng':'116.277886'},{'lat':'40.038047','lng':'116.279638'},{'lat':'40.033551','lng':'116.28359'},{'lat':'40.030181','lng':'116.286501'},{'lat':'40.028538','lng':'116.287992'},{'lat':'40.027585','lng':'116.28889'},{'lat':'40.025989','lng':'116.290247'},{'lat':'40.024684','lng':'116.291379'},{'lat':'40.023579','lng':'116.29234'},{'lat':'40.023123','lng':'116.292645'},{'lat':'40.022398','lng':'116.293068'},{'lat':'40.021769','lng':'116.293337'},{'lat':'40.0213','lng':'116.29349'},{'lat':'40.019497','lng':'116.293786'},{'lat':'40.012576','lng':'116.294864'},{'lat':'40.008687','lng':'116.29552'},{'lat':'40.008445','lng':'116.295565'},{'lat':'40.008141','lng':'116.295682'},{'lat':'40.007934','lng':'116.295852'},{'lat':'40.007609','lng':'116.296167'},{'lat':'40.007119','lng':'116.296724'},{'lat':'40.006393','lng':'116.297703'},{'lat':'40.005343','lng':'116.299104'},{'lat':'40.004611','lng':'116.300119'},{'lat':'40.004114','lng':'116.300811'},{'lat':'40.003858','lng':'116.301053'},{'lat':'40.003547','lng':'116.301287'},{'lat':'40.003215','lng':'116.301431'},{'lat':'40.002877','lng':'116.30153'},{'lat':'40.001951','lng':'116.301709'},{'lat':'40.001108','lng':'116.301853'},{'lat':'40.000569','lng':'116.301961'},{'lat':'40.000182','lng':'116.302131'},{'lat':'39.999927','lng':'116.302266'},{'lat':'39.999457','lng':'116.30267'},{'lat':'39.999167','lng':'116.302976'},{'lat':'39.998649','lng':'116.303623'},{'lat':'39.998034','lng':'116.304341'},{'lat':'39.997709','lng':'116.304728'},{'lat':'39.997571','lng':'116.304862'},{'lat':'39.997136','lng':'116.305302'},{'lat':'39.996901','lng':'116.305518'},{'lat':'39.996514','lng':'116.305734'},{'lat':'39.995816','lng':'116.305868'},{'lat':'39.994641','lng':'116.306075'},{'lat':'39.991097','lng':'116.30656'},{'lat':'39.989279','lng':'116.306812'},{'lat':'39.987877','lng':'116.306964'},{'lat':'39.983516','lng':'116.307333'},{'lat':'39.981885','lng':'116.307503'},{'lat':'39.981305','lng':'116.307548'},{'lat':'39.981111','lng':'116.307557'},{'lat':'39.98089','lng':'116.307575'},{'lat':'39.980593','lng':'116.307665'},{'lat':'39.980227','lng':'116.307845'},{'lat':'39.979846','lng':'116.30806'},{'lat':'39.979453','lng':'116.308384'},{'lat':'39.978983','lng':'116.308824'},{'lat':'39.978485','lng':'116.309524'},{'lat':'39.977642','lng':'116.310836'},{'lat':'39.976453','lng':'116.312642'},{'lat':'39.976163','lng':'116.313091'},{'lat':'39.975962','lng':'116.313279'},{'lat':'39.975796','lng':'116.313387'},{'lat':'39.975568','lng':'116.313468'},{'lat':'39.974663','lng':'116.313576'},{'lat':'39.973205','lng':'116.313747'},{'lat':'39.972272','lng':'116.313917'},{'lat':'39.968339','lng':'116.314618'},{'lat':'39.967094','lng':'116.314753'},{'lat':'39.965539','lng':'116.315076'},{'lat':'39.96424','lng':'116.315381'},{'lat':'39.962878','lng':'116.315615'},{'lat':'39.960942','lng':'116.315813'},{'lat':'39.960161','lng':'116.315884'},{'lat':'39.95976','lng':'116.315893'},{'lat':'39.959691','lng':'116.316154'},{'lat':'39.959608','lng':'116.316307'},{'lat':'39.959414','lng':'116.316388'},{'lat':'39.95938','lng':'116.316738'},{'lat':'39.959276','lng':'116.316801'},{'lat':'39.959221','lng':'116.317483'},{'lat':'39.95909','lng':'116.317528'},{'lat':'39.959027','lng':'116.317708'},{'lat':'39.95902','lng':'116.318013'},{'lat':'39.959027','lng':'116.318588'},{'lat':'39.958633','lng':'116.31857'},{'lat':'39.957873','lng':'116.318606'},{'lat':'39.957133','lng':'116.318705'},{'lat':'39.957258','lng':'116.320044'},{'lat':'39.956421','lng':'116.320259'},{'lat':'39.954948','lng':'116.320699'},{'lat':'39.953746','lng':'116.321005'},{'lat':'39.953801','lng':'116.32175'},{'lat':'39.953994','lng':'116.323763'},{'lat':'39.952785','lng':'116.323978'},{'lat':'39.951768','lng':'116.324113'},{'lat':'39.951962','lng':'116.327176'},{'lat':'39.952003','lng':'116.328003'},{'lat':'39.950697','lng':'116.328254'},{'lat':'39.949438','lng':'116.328524'},{'lat':'39.949812','lng':'116.331776'},{'lat':'39.949825','lng':'116.333132'},{'lat':'39.949846','lng':'116.335423'},{'lat':'39.94986','lng':'116.335656'},{'lat':'39.94957','lng':'116.335701'},{'lat':'39.94921','lng':'116.335656'},{'lat':'39.948781','lng':'116.335755'},{'lat':'39.948685','lng':'116.335791'},{'lat':'39.94894','lng':'116.336617'},{'lat':'39.949079','lng':'116.33739'},{'lat':'39.949245','lng':'116.33792'},{'lat':'39.949618','lng':'116.338468'},{'lat':'39.949791','lng':'116.338791'},{'lat':'39.949798','lng':'116.339178'},{'lat':'39.949715','lng':'116.339717'},{'lat':'39.949556','lng':'116.34004'},{'lat':'39.949224','lng':'116.34048'},{'lat':'39.949106','lng':'116.34075'},{'lat':'39.949155','lng':'116.341019'},{'lat':'39.949175','lng':'116.34145'},{'lat':'39.949099','lng':'116.341783'},{'lat':'39.94883','lng':'116.342923'},{'lat':'39.948823','lng':'116.343462'},{'lat':'39.94874','lng':'116.343849'},{'lat':'39.948595','lng':'116.344531'},{'lat':'39.948546','lng':'116.345008'},{'lat':'39.948685','lng':'116.345915'},{'lat':'39.948809','lng':'116.346589'},{'lat':'39.94883','lng':'116.34719'},{'lat':'39.948809','lng':'116.347613'},{'lat':'39.948761','lng':'116.348358'},{'lat':'39.948781','lng':'116.349283'},{'lat':'39.948989','lng':'116.351089'},{'lat':'39.949487','lng':'116.350918'},{'lat':'39.949825','lng':'116.350873'},{'lat':'39.950137','lng':'116.350963'},{'lat':'39.950745','lng':'116.350667'},{'lat':'39.951104','lng':'116.350658'},{'lat':'39.951312','lng':'116.350433'},{'lat':'39.951941','lng':'116.350793'},{'lat':'39.95257','lng':'116.349041'},{'lat':'39.953455','lng':'116.347424'},{'lat':'39.955301','lng':'116.344388'},{'lat':'39.95584','lng':'116.343741'},{'lat':'39.955757','lng':'116.343094'},{'lat':'39.955709','lng':'116.341989'},{'lat':'39.955764','lng':'116.341801'},{'lat':'39.956103','lng':'116.341432'},{'lat':'39.956345','lng':'116.341118'},{'lat':'39.956442','lng':'116.340786'},{'lat':'39.956456','lng':'116.340705'},{'lat':'39.956649','lng':'116.340561'},{'lat':'39.956656','lng':'116.340094'},{'lat':'39.956628','lng':'116.339303'},{'lat':'39.957742','lng':'116.33924'},{'lat':'39.957783','lng':'116.340013'},{'lat':'39.958108','lng':'116.340004'},{'lat':'39.958163','lng':'116.340777'},{'lat':'39.959131','lng':'116.340651'},{'lat':'39.959698','lng':'116.340633'},{'lat':'39.959912','lng':'116.340354'},{'lat':'39.959981','lng':'116.340265'},{'lat':'39.961267','lng':'116.340157'},{'lat':'39.962028','lng':'116.340202'},{'lat':'39.962097','lng':'116.340678'},{'lat':'39.962677','lng':'116.340606'},{'lat':'39.963244','lng':'116.340642'},{'lat':'39.963293','lng':'116.341837'},{'lat':'39.966113','lng':'116.341504'},{'lat':'39.973232','lng':'116.340803'},{'lat':'39.97411','lng':'116.340732'},{'lat':'39.974055','lng':'116.339752'},{'lat':'39.974366','lng':'116.339717'},{'lat':'39.974387','lng':'116.338872'},{'lat':'39.974366','lng':'116.337974'},{'lat':'39.974324','lng':'116.337013'},{'lat':'39.97487','lng':'116.336968'},{'lat':'39.975824','lng':'116.336905'},{'lat':'39.975859','lng':'116.335683'},{'lat':'39.977158','lng':'116.335575'},{'lat':'39.977123','lng':'116.33447'},{'lat':'39.97722','lng':'116.334443'},{'lat':'39.977365','lng':'116.334363'},{'lat':'39.97816','lng':'116.334336'},{'lat':'39.978665','lng':'116.334255'},{'lat':'39.978727','lng':'116.336447'},{'lat':'39.978782','lng':'116.338648'},{'lat':'39.978858','lng':'116.340444'},{'lat':'39.979335','lng':'116.340417'},{'lat':'39.980434','lng':'116.340444'},{'lat':'39.981325','lng':'116.340471'},{'lat':'39.982134','lng':'116.340345'},{'lat':'39.982162','lng':'116.340678'},{'lat':'39.982092','lng':'116.34357'},{'lat':'39.98212','lng':'116.346768'},{'lat':'39.984048','lng':'116.346292'},{'lat':'39.986881','lng':'116.345762'},{'lat':'39.991995','lng':'116.344972'},{'lat':'39.994413','lng':'116.344702'},{'lat':'39.998752','lng':'116.344451'},{'lat':'40.006241','lng':'116.344235'},{'lat':'40.013094','lng':'116.343588'},{'lat':'40.014586','lng':'116.343049'},{'lat':'40.015525','lng':'116.342474'},{'lat':'40.018012','lng':'116.339815'},{'lat':'40.022543','lng':'116.334749'},{'lat':'40.024366','lng':'116.333132'},{'lat':'40.02619','lng':'116.332198'},{'lat':'40.030913','lng':'116.330257'},{'lat':'40.034366','lng':'116.329503'},{'lat':'40.036382','lng':'116.328892'},{'lat':'40.037708','lng':'116.328425'},{'lat':'40.038509','lng':'116.328083'},{'lat':'40.039359','lng':'116.327446'},{'lat':'40.040208','lng':'116.326664'},{'lat':'40.041395','lng':'116.325353'},{'lat':'40.042749','lng':'116.323763'},{'lat':'40.043847','lng':'116.32255'},{'lat':'40.044779','lng':'116.321697'},{'lat':'40.04598','lng':'116.320798'},{'lat':'40.046815','lng':'116.32034'},{'lat':'40.048645','lng':'116.319307'},{'lat':'40.049018','lng':'116.319082'},{'lat':'40.049598','lng':'116.318687'},{'lat':'40.051586','lng':'116.31707'},{'lat':'40.055749','lng':'116.313935'},{'lat':'40.056757','lng':'116.313199'},{'lat':'40.059697','lng':'116.31133'},{'lat':'40.061927','lng':'116.309965'},{'lat':'40.063425','lng':'116.309138'},{'lat':'40.064584','lng':'116.308527'},{'lat':'40.070085','lng':'116.305374'},{'lat':'40.073357','lng':'116.303488'},{'lat':'40.080768','lng':'116.299185'},{'lat':'40.083301','lng':'116.297685'},{'lat':'40.084101','lng':'116.29711'},{'lat':'40.08495','lng':'116.296427'},{'lat':'40.085433','lng':'116.296005'},{'lat':'40.086289','lng':'116.295277'},{'lat':'40.087372','lng':'116.294217'},{'lat':'40.087979','lng':'116.293589'},{'lat':'40.088386','lng':'116.293094'},{'lat':'40.089083','lng':'116.292295'},{'lat':'40.08947','lng':'116.291765'},{'lat':'40.090208','lng':'116.290669'},{'lat':'40.093823','lng':'116.284507'},{'lat':'40.094755','lng':'116.282899'}]";
	
	static String type = "zdqy";
	static String geotype = "Polygon";
	static String name = "中关村大街";
	static String code = "120060";
	static String targetUrl = "E:/work/workspace2016/report/WebRoot/map/json/hd_zgcdj.json";

	public void gotoJson() throws IOException {
		
		JSONObject jsonObject = Utils.getGeoJsonTemplate();
		JSONArray jsonArray = jsonObject.getJSONArray("features");
		
		JSONObject zmqObject = jsonArray.getJSONObject(0);
		JSONObject geometryObject = zmqObject.getJSONObject("geometry");
		geometryObject.put("type", geotype);

		//////////////////////////////////////////////////////////////
		
		Double strs[][][] = new Double[1][][];
		List<Double[]> clist = new ArrayList<Double[]>();
		
		JSONArray zmq_1Array = JSONArray.parseArray(zgcdjstr);
		List<Double[]> list1 = new ArrayList<Double[]>();
		for(int i=0;i<zmq_1Array.size();i++){
			JSONObject lnglat = zmq_1Array.getJSONObject(i);
			Double lnglats[] = new Double[]{lnglat.getDouble("lng"),lnglat.getDouble("lat")};
			list1.add(lnglats);
			clist.add(lnglats);
		}
		Double arr1[][] = new Double[list1.size()][];
		for(int i=0;i<list1.size();i++){
			arr1[i] = list1.get(i);
		}
		strs[0] = arr1;
		
		
		
		geometryObject.put("coordinates", strs);
		
		JSONObject propertiesObject = zmqObject.getJSONObject("properties");
		propertiesObject.put("gridname", name);
		propertiesObject.put("gridid", code);
		Map<String, Double> centerPoint = Utils.getCenterPoint(clist);
		propertiesObject.put("X", centerPoint.get("lng"));
		propertiesObject.put("Y", centerPoint.get("lat"));
		
		FileManager.saveFile(targetUrl, jsonObject.toJSONString());
		
	}
	
	
	public void jsonToDb() throws IOException {
		MysqlHelper.getConnection("jdbc:mysql://192.168.5.72:3311/cenmds?serverTimezone=Asia/Shanghai&characterEncoding=utf8&useUnicode=true&useSSL=false&allowMultiQueries=true&autoReconnect=true","root","mysql");
		
		File jsonFile = new File(targetUrl);
		String readFile = FileManager.readFile(jsonFile);
		System.out.println(readFile);
		JSONObject jsonObject = JSON.parseObject(readFile);
		JSONArray jsonArray = jsonObject.getJSONArray("features");
		String type = this.type;
		for(int i=0;i<jsonArray.size();i++){
			JSONObject jdObject = jsonArray.getJSONObject(i);
			
			JSONObject jdGeometry = jdObject.getJSONObject("geometry");
			
			JSONObject jdProperties = jdObject.getJSONObject("properties");
			String name = jdProperties.getString("gridname");
			String code = jdProperties.getString("gridid");
			String centerlng = jdProperties.getString("X");
			String centerlat = jdProperties.getString("Y");
			String geotype = jdGeometry.getString("type");
			
			String lnglat = jdGeometry.getString("coordinates");
			
			MysqlHelper.executeUpdate("insert into hdq_area_lnglat values(?,?,?,?,?,?,?,?,?,?)", new String[]{null, code, name, type, lnglat, "bd", geotype, centerlng, centerlat, ""});
			
		}
		
		MysqlHelper.close();
	}
	
	public static void main(String[] args) throws IOException {
		ZgcDj obj = new ZgcDj();
		obj.gotoJson();
		obj.jsonToDb();
	}
}
